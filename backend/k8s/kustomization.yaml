apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: codeclashers

resources:
# Namespace
- namespaces/codeclashers.yaml

# Storage (keeping for backward compatibility, but clusters use volumeClaimTemplates)
# - storage/mongodb-pvc.yaml
# - storage/redis-pvc.yaml

# MongoDB Replica Set Services
- mongodb/headless-service.yaml
- mongodb/service.yaml

# Redis Cluster Services
- services/redis-cluster-headless.yaml
- services/redis-cluster-service.yaml
# Legacy single Redis instance (commented out)
# - services/redis-service.yaml

# Other Services
- services/postgres-service.yaml
- services/judge0-server-service.yaml
- services/colyseus-service.yaml
- services/bots-service.yaml

# ConfigMaps and Secrets
- configmaps/app-config.yaml
- configmaps/redis-cluster-config.yaml
- mongodb/configmap.yaml

# MongoDB Replica Set StatefulSet
- mongodb/statefulset.yaml

# Redis Cluster StatefulSet
- statefulsets/redis-cluster.yaml
# Legacy single Redis instance (commented out)
# - statefulsets/redis.yaml

# Deployments
- deployments/postgres.yaml
- deployments/judge0-server.yaml
- deployments/judge0-worker.yaml
- deployments/colyseus.yaml
- deployments/bots.yaml

# Jobs (Cluster Initialization)
- mongodb/init-job.yaml
- jobs/redis-cluster-init.yaml

# PodDisruptionBudgets
- mongodb/pdb.yaml
- pdbs/colyseus-pdb.yaml
- pdbs/judge0-server-pdb.yaml
- pdbs/judge0-worker-pdb.yaml
- pdbs/bots-pdb.yaml

# Monitoring Stack
- monitoring/kustomization.yaml
