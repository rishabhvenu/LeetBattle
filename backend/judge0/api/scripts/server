#!/bin/bash
set -e

# Load config (languages.json, DB config variables, etc)
source ./scripts/load-config

# Ensure no leftover PID files
rm -f tmp/pids/server.pid

# Rails database setup (safe on repeat)
bundle exec rails db:create    || true
bundle exec rails db:migrate   || true
bundle exec rails db:seed      || true

# Start Judge0 API server on correct port
# Use exec to replace shell process with Rails server
# Explicitly use full path to bundle and ensure arguments are passed correctly
exec /usr/local/bin/bundle exec rails server -b 0.0.0.0 -p 2358
