(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1597],{22630:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoneSerializer=void 0;class n{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}t.NoneSerializer=n},23257:function(e,t,n){"use strict";var i,r,o,s,a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},c=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;let f=n(47124),u=n(49458);class l{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},i.set(this,!1),r.set(this,void 0),o.set(this,void 0),s.set(this,(0,u.createNanoEvents)()),(0,f.getItem)(this.settings.key,e=>this.token=e)}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){let t=c(this,s,"f").on("change",e);return c(this,i,"f")||h(this,r,new Promise((e,t)=>{this.getUserData().then(e=>{this.emitChange(Object.assign(Object.assign({},e),{token:this.token}))}).catch(e=>{this.emitChange({user:null,token:void 0})}).finally(()=>{e()})}),"f"),h(this,i,!0,"f"),t}getUserData(){return a(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw Error("missing auth.token")})}registerWithEmailAndPassword(e,t,n){return a(this,void 0,void 0,function*(){let i=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:t,options:n}})).data;return this.emitChange(i),i})}signInWithEmailAndPassword(e,t){return a(this,void 0,void 0,function*(){let n=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:t}})).data;return this.emitChange(n),n})}signInAnonymously(e){return a(this,void 0,void 0,function*(){let t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(t),t})}sendPasswordResetEmail(e){return a(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data})}signInWithProvider(e,t={}){return a(this,void 0,void 0,function*(){return new Promise((n,i)=>{let r=t.width||480,s=t.height||768,a=this.token?`?token=${this.token}`:"",f=`Login with ${e[0].toUpperCase()+e.substring(1)}`,u=this.http.client.getHttpEndpoint(`${t.prefix||`${this.settings.path}/provider`}/${e}${a}`),l=screen.width/2-r/2,d=screen.height/2-s/2;h(this,o,window.open(u,f,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+s+", top="+d+", left="+l),"f");let p=e=>{(void 0!==e.data.user||void 0!==e.data.token)&&(clearInterval(v),c(this,o,"f").close(),h(this,o,void 0,"f"),window.removeEventListener("message",p),void 0!==e.data.error?i(e.data.error):(n(e.data),this.emitChange(e.data)))},v=setInterval(()=>{(!c(this,o,"f")||c(this,o,"f").closed)&&(h(this,o,void 0,"f"),i("cancelled"),window.removeEventListener("message",p))},200);window.addEventListener("message",p)})})}signOut(){return a(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(e){void 0!==e.token&&(this.token=e.token,null===e.token?(0,f.removeItem)(this.settings.key):(0,f.setItem)(this.settings.key,e.token)),c(this,s,"f").emit("change",e)}}t.Auth=l,i=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap},44616:function(e,t){(function(e){"use strict";var t,n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function r(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function o(e,t,n){if(n||2==arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,e.OPERATION=void 0,(t=e.OPERATION||(e.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var s=function(){function t(e,t,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(t,n)}return t.prototype.setParent=function(e,t,n){var i=this;if(this.indexes||(this.indexes=this.ref instanceof er?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=n,t)if(this.root=t,this.ref instanceof er){var r=this.ref._definition;for(var o in r.schema){var s=this.ref[o];if(s&&s.$changes){var a=r.indexes[o];s.$changes.setParent(this.ref,t,a)}}}else"object"==typeof this.ref&&this.ref.forEach(function(e,t){if(e instanceof er){var n=e.$changes,r=i.ref.$changes.indexes[t];n.setParent(i.ref,i.root,r)}})},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(t,n){void 0===n&&(n=e.OPERATION.ADD);var i="number"==typeof t?t:this.indexes[t];this.assertValidIndex(i,t);var r=this.changes.get(i);r&&r.op!==e.OPERATION.DELETE&&r.op!==e.OPERATION.TOUCH||this.changes.set(i,{op:r&&r.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:n,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},t.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t),this.changes.has(n)||this.changes.set(n,{op:e.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition){var t=this.ref._definition;return t.schema[t.fieldsByIndex[e]]}var t=this.parent._definition;return Object.values(t.schema[t.fieldsByIndex[this.parentIndex]])[0]},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0===n)return void console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(t," (").concat(n,")"));var i=this.getValue(n);this.changes.set(n,{op:e.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],i&&i.$changes&&(i.$changes.parent=void 0),this.changed=!0,this.touchParents()},t.prototype.discard=function(t,n){var i=this;void 0===t&&(t=!1),void 0===n&&(n=!1),this.ref instanceof er||this.changes.forEach(function(t){if(t.op===e.OPERATION.DELETE){var n=i.ref.getIndex(t.index);delete i.indexes[n]}}),this.changes.clear(),this.changed=t,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(t){var n=e.getValue(t.index);n&&n.$changes&&n.$changes.discardAll()}),this.discard()},t.prototype.cache=function(e,t){this.caches[e]=t},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,t){if(void 0===e)throw Error('ChangeTree: missing index for field "'.concat(t,'"'))},t}();function a(e,t,n,i){return e[t]||(e[t]=[]),e[t].push(n),null==i||i.forEach(function(e,t){return n(e,t)}),function(){return h(e[t],e[t].indexOf(n))}}function c(t){var n=this,i="string"!=typeof this.$changes.getType();this.$items.forEach(function(r,o){t.push({refId:n.$changes.refId,op:e.OPERATION.DELETE,field:o,value:void 0,previousValue:r}),i&&n.$changes.root.removeRef(r.$changes.refId)})}function h(e,t){if(-1===t||t>=e.length)return!1;for(var n=e.length-1,i=t;i<n;i++)e[i]=e[i+1];return e.length=n,!0}var f=function(e,t){var n=e.toString(),i=t.toString();return n<i?-1:+(n>i)},u=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks={}),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return a(this.$callbacks||(this.$callbacks={}),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks={}),e.OPERATION.REPLACE,t)},t.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e,t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return n.forEach(function(n){e=t.$refId++,t.setAt(e,n)}),e},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var t=this.$items.get(e);return this.$items.delete(e),t}},t.prototype.at=function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0)&&!(e>=this.length)){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)}},t.prototype.setAt=function(t,n){if(null==n)return void console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");if(this.$items.get(t)!==n){void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,t);var i,r,o=null!=(r=null==(i=this.$changes.indexes[t])?void 0:i.op)?r:e.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,n),this.$changes.change(t,o)}},t.prototype.deleteAt=function(e){var t=Array.from(this.$items.keys())[e];return void 0!==t&&this.$deleteAt(t)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&c.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(t.bind.apply(t,o([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n),!1)))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,t=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(n,i){e.setAt(t[i],n)}),this},t.prototype.shift=function(){var e=Array.from(this.$items.keys()).shift();if(void 0!==e){var t=this.$items.get(e);return this.$deleteAt(e),t}},t.prototype.slice=function(e,n){var i=new t;return i.push.apply(i,Array.from(this.$items.values()).slice(e,n)),i},t.prototype.sort=function(e){var t=this;void 0===e&&(e=f);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach(function(e,i){t.setAt(n[i],e)}),this},t.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var r=Array.from(this.$items.keys()),o=[],s=e;s<e+t;s++)o.push(this.$items.get(r[s])),this.$deleteAt(r[s]);for(var s=0;s<n.length;s++)this.setAt(e+s,n[s]);return o},t.prototype.unshift=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.length,r=t.length,o=Array.from(this.$items.values());return t.forEach(function(t,n){e.setAt(n,t)}),o.forEach(function(t,n){e.setAt(r+n,t)}),i+r},t.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)},t.prototype.lastIndexOf=function(e,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,t)},t.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)},t.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)},t.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)},t.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)},t.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)},t.prototype.reduce=function(e,t){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},t.prototype.reduceRight=function(e,t){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},t.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)},t.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)},t.prototype.fill=function(e,t,n){throw Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,t,n){throw Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)},t.prototype.flatMap=function(e,t){throw Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw Error("ArraySchema#flat() is not supported.")},t.prototype.findLast=function(){var e=Array.from(this.$items.values());return e.findLast.apply(e,arguments)},t.prototype.findLastIndex=function(){var e=Array.from(this.$items.values());return e.findLastIndex.apply(e,arguments)},t.prototype.with=function(e,n){var i=Array.from(this.$items.values());return i[e]=n,new(t.bind.apply(t,o([void 0],i,!1)))},t.prototype.toReversed=function(){return Array.from(this.$items.values()).reverse()},t.prototype.toSorted=function(e){return Array.from(this.$items.values()).sort(e)},t.prototype.toSpliced=function(e,t){var n=Array.from(this.$items.values());return n.toSpliced.apply(n,arguments)},t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},t.prototype.clone=function(e){return e?new(t.bind.apply(t,o([void 0],Array.from(this.$items.values()),!1))):new(t.bind.apply(t,o([void 0],this.map(function(e){return e.$changes?e.clone():e}),!1)))},t}(),l=function(){function t(e){var n=this;if(this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map||e instanceof t)e.forEach(function(e,t){return n.set(t,e)});else for(var i in e)this.set(i,e[i])}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks={}),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return a(this.$callbacks||(this.$callbacks={}),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks={}),e.OPERATION.REPLACE,t)},t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.set=function(t,n){if(null==n)throw Error("MapSchema#set('".concat(t,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(t,"'."));t=t.toString();var i=void 0!==this.$changes.indexes[t],r=i?this.$changes.indexes[t]:this.$refId++,o=i?e.OPERATION.REPLACE:e.OPERATION.ADD,s=void 0!==n.$changes;if(s&&n.$changes.setParent(this,this.$changes.root,r),i){if(!s&&this.$items.get(t)===n)return;s&&this.$items.get(t)!==n&&(o=e.OPERATION.ADD)}else this.$changes.indexes[t]=r,this.$indexes.set(r,t);return this.$items.set(t,n),this.$changes.change(t,o),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e.toString()),this.$items.delete(e)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&c.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach(function(t,n){e[n]="function"==typeof t.toJSON?t.toJSON():t}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(e,t){e.$changes?n.set(t,e.clone()):n.set(t,e)})),n},t}(),d={},p=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(t){var n=new e;return n.schema=Object.assign({},t&&t.schema||{}),n.indexes=Object.assign({},t&&t.indexes||{}),n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),n.descriptors=Object.assign({},t&&t.descriptors||{}),n.deprecated=Object.assign({},t&&t.deprecated||{}),n},e.prototype.addField=function(e,t){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=e,this.indexes[e]=n,this.schema[e]=Array.isArray(t)?{array:t[0]}:t},e.prototype.hasField=function(e){return void 0!==this.indexes[e]},e.prototype.addFilter=function(e,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=t,this.indexesWithFilters.push(this.indexes[e]),!0},e.prototype.addChildrenFilter=function(e,t){var n=this.indexes[e];if(d[Object.keys(this.schema[e])[0]])return this.childFilters||(this.childFilters={}),this.childFilters[n]=t,!0;console.warn("@filterChildren: field '".concat(e,"' can't have children. Ignoring filter."))},e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}(),v=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size),e._definition=p.create(e._definition),e._typeid=t,this.types[t]=e,this.schemas.set(e,t)},e.create=function(t){return void 0===t&&(t={}),function(n){return t.context||(t.context=new e),y(n,t)}},e}(),g=new v;function y(e,t){return void 0===t&&(t={}),function(n,i){var r=t.context||g,s=n.constructor;if(s._context=r,!e)throw Error("".concat(s.name,': @type() reference provided for "').concat(i,"\" is undefined. Make sure you don't have any circular dependencies."));r.has(s)||r.add(s);var a=s._definition;if(a.addField(i,e),a.descriptors[i])if(a.deprecated[i])return;else try{throw Error("@colyseus/schema: Duplicate '".concat(i,"' definition on '").concat(s.name,"'.\nCheck @type() annotation"))}catch(e){var c=e.stack.split("\n")[4].trim();throw Error("".concat(e.message," ").concat(c))}var h=u.is(e),f=!h&&l.is(e);if("string"!=typeof e&&!er.is(e)){var d=Object.values(e)[0];"string"==typeof d||r.has(d)||r.add(d)}if(t.manual){a.descriptors[i]={enumerable:!0,configurable:!0,writable:!0};return}var p="_".concat(i);a.descriptors[p]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[i]={get:function(){return this[p]},set:function(e){if(e!==this[p]){if(null!=e){var t,n;!h||e instanceof u||(e=new(u.bind.apply(u,o([void 0],e,!1)))),!f||e instanceof l||(e=new l(e)),void 0===e.$proxy&&(f?((t=e).$proxy=!0,e=t=new Proxy(t,{get:function(e,t){return"symbol"!=typeof t&&void 0===e[t]?e.get(t):e[t]},set:function(e,t,n){return"symbol"!=typeof t&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,n):e[t]=n,!0},deleteProperty:function(e,t){return e.delete(t),!0}})):h&&((n=e).$proxy=!0,e=n=new Proxy(n,{get:function(e,t){return"symbol"==typeof t||isNaN(t)?e[t]:e.at(t)},set:function(e,t,n){if("symbol"==typeof t||isNaN(t))e[t]=n;else{var i=parseInt(Array.from(e.$items.keys())[t]||t);null==n?e.deleteAt(i):e.setAt(i,n)}return!0},deleteProperty:function(e,t){return"number"==typeof t?e.deleteAt(t):delete e[t],!0},has:function(e,t){return"symbol"==typeof t||isNaN(Number(t))?Reflect.has(e,t):e.$items.has(Number(t))}}))),this.$changes.change(i),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])}else void 0!==this[p]&&this.$changes.delete(i);this[p]=e}},enumerable:!0,configurable:!0}}}function m(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)(i=n.charCodeAt(r))<128?e[t++]=i:(i<2048?e[t++]=192|i>>6:(i<55296||i>=57344?e[t++]=224|i>>12:(r++,i=65536+((1023&i)<<10|1023&n.charCodeAt(r)),e[t++]=240|i>>18,e[t++]=128|i>>12&63),e[t++]=128|i>>6&63),e[t++]=128|63&i)}function E(e,t){e.push(255&t)}function _(e,t){e.push(255&t)}function $(e,t){e.push(255&t),e.push(t>>8&255)}function A(e,t){e.push(255&t),e.push(t>>8&255)}function O(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function w(e,t){e.push(255&t),e.push(255&t>>8),e.push(255&t>>16),e.push(255&t>>24)}function b(e,t){var n=Math.floor(t/0x100000000);w(e,t>>>0),w(e,n)}function I(e,t){w(e,t>>>0),w(e,t/0x100000000|0)}var x=new Int32Array(2),T=new Float32Array(x.buffer),R=new Float64Array(x.buffer);function P(e,t){T[0]=t,O(e,x[0])}function C(e,t){R[0]=t,O(e,x[0]),O(e,x[1])}function S(e,t){t||(t="");var n=function(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(t),i=0;if(n<32)e.push(160|n),i=1;else if(n<256)e.push(217),_(e,n),i=2;else if(n<65536)e.push(218),A(e,n),i=3;else if(n<0x100000000)e.push(219),w(e,n),i=5;else throw Error("String too long");return m(e,e.length,t),i+n}function D(e,t){return isNaN(t)?D(e,0):isFinite(t)?t!==(0|t)?(e.push(203),C(e,t),9):t>=0?t<128?(_(e,t),1):t<256?(e.push(204),_(e,t),2):t<65536?(e.push(205),A(e,t),3):t<0x100000000?(e.push(206),w(e,t),5):(e.push(207),I(e,t),9):t>=-32?(e.push(224|t+32),1):t>=-128?(e.push(208),E(e,t),2):t>=-32768?(e.push(209),$(e,t),3):t>=-0x80000000?(e.push(210),O(e,t),5):(e.push(211),b(e,t),9):D(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var k=Object.freeze({__proto__:null,boolean:function(e,t){return _(e,+!!t)},float32:function(e,t){P(e,t)},float64:function(e,t){C(e,t)},int16:$,int32:O,int64:b,int8:E,number:D,string:S,uint16:A,uint32:w,uint64:I,uint8:_,utf8Write:m,writeFloat32:P,writeFloat64:C});function N(e,t){return M(e,t)<<24>>24}function M(e,t){return e[t.offset++]}function L(e,t){return j(e,t)<<16>>16}function j(e,t){return e[t.offset++]|e[t.offset++]<<8}function U(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function B(e,t){return U(e,t)>>>0}function H(e,t){var n=B(e,t);return 0x100000000*U(e,t)+n}function F(e,t){var n=B(e,t);return 0x100000000*B(e,t)+n}var z=new Int32Array(2),V=new Float32Array(z.buffer),J=new Float64Array(z.buffer);function W(e,t){return z[0]=U(e,t),V[0]}function K(e,t){return z[0]=U(e,t),z[1]=U(e,t),J[0]}function q(e,t){var n,i=e[t.offset++];i<192?n=31&i:217===i?n=M(e,t):218===i?n=j(e,t):219===i&&(n=B(e,t));var r=function(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];if((128&a)==0){i+=String.fromCharCode(a);continue}if((224&a)==192){i+=String.fromCharCode((31&a)<<6|63&e[++o]);continue}if((240&a)==224){i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|63&e[++o]);continue}if((248&a)==240){(r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|63&e[++o])>=65536?(r-=65536,i+=String.fromCharCode((r>>>10)+55296,(1023&r)+56320)):i+=String.fromCharCode(r);continue}console.error("Invalid byte "+a.toString(16))}return i}(e,t.offset,n);return t.offset+=n,r}function X(e,t){var n=e[t.offset++];if(n<128)return n;if(202===n)return W(e,t);if(203===n)return K(e,t);if(204===n)return M(e,t);if(205===n)return j(e,t);else if(206===n)return B(e,t);else if(207===n)return F(e,t);else if(208===n)return N(e,t);else if(209===n)return L(e,t);else if(210===n)return U(e,t);else if(211===n)return H(e,t);else if(n>223)return-((255-n+1)*1)}function Y(e,t){return 255===e[t.offset-1]&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var G=Object.freeze({__proto__:null,arrayCheck:function(e,t){return e[t.offset]<160},boolean:function(e,t){return M(e,t)>0},float32:function(e,t){return W(e,t)},float64:function(e,t){return K(e,t)},int16:L,int32:U,int64:H,int8:N,number:X,numberCheck:function(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211},readFloat32:W,readFloat64:K,string:q,stringCheck:function(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n},switchStructureCheck:Y,uint16:j,uint32:B,uint64:F,uint8:M}),Q=function(){function t(e){var t=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(e){return t.add(e)})}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return a(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},t.is=function(e){return void 0!==e.collection},t.prototype.add=function(e){var t=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t),t},t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&c.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some(function(t){return t===e})},t.prototype.forEach=function(e){var t=this;this.$items.forEach(function(n,i,r){return e(n,i,t)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(e){e.$changes?n.add(e.clone()):n.add(e)})),n},t}(),Z=function(){function t(e){var t=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(e){return t.add(e)})}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return a(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},t.is=function(e){return void 0!==e.set},t.prototype.add=function(t){if(this.has(t))return!1;var n,i,r=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,r);var o=null!=(i=null==(n=this.$changes.indexes[r])?void 0:n.op)?i:e.OPERATION.ADD;return this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,t),this.$changes.change(r,o),r},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&c.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var t,n=this.$items.values(),i=!1;(t=n.next())&&!t.done;)if(e===t.value){i=!0;break}return i},t.prototype.forEach=function(e){var t=this;this.$items.forEach(function(n,i,r){return e(n,i,t)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(e){e.$changes?n.add(e.clone()):n.add(e)})),n},t}(),ee=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},e.get=function(t){return void 0===t.$filterState&&(t.$filterState=new e),t.$filterState},e}(),et=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(e,t,n){void 0===n&&(n=!0),this.refs.set(e,t),n&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},e.prototype.removeRef=function(e){var t=this.refCounts[e];return void 0===t?void console.warn("trying to remove reference ".concat(e," that doesn't exist")):0===t?void console.warn("trying to remove reference ".concat(e," with 0 refCount")):void(this.refCounts[e]=t-1,this.deletedRefs.add(e))},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(t){if(!(e.refCounts[t]>0)){var n=e.refs.get(t);if(n instanceof er)for(var i in n._definition.schema)"string"!=typeof n._definition.schema[i]&&n[i]&&n[i].$changes&&e.removeRef(n[i].$changes.refId);else{var r=n.$changes.parent._definition;"function"==typeof Object.values(r.schema[r.fieldsByIndex[n.$changes.parentIndex]])[0]&&Array.from(n.values()).forEach(function(t){return e.removeRef(t.$changes.refId)})}e.refs.delete(t),delete e.refCounts[t]}}),this.deletedRefs.clear()},e}(),en=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(Error);function ei(e,t,n,i){if(!(e instanceof t))throw new en("a '".concat(t.name,"' was expected, but '").concat(e.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(i))}var er=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new s(this,void 0,new et),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&void 0!==e._definition.schema},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks={}),e.OPERATION.REPLACE,t)},t.prototype.onRemove=function(t){return a(this.$callbacks||(this.$callbacks={}),e.OPERATION.DELETE,t)},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.setDirty=function(e,t){this.$changes.change(e,t)},t.prototype.listen=function(e,t,n){var i=this;return void 0===n&&(n=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[e]||(this.$callbacks[e]=[]),this.$callbacks[e].push(t),n&&void 0!==this[e]&&t(this[e],void 0),function(){return h(i.$callbacks[e],i.$callbacks[e].indexOf(t))}},t.prototype.decode=function(n,i,r){void 0===i&&(i={offset:0}),void 0===r&&(r=this);var o=[],s=this.$changes.root,a=n.length,c=0;for(s.refs.set(c,this);i.offset<a;){var h,f=n[i.offset++];if(255==f){c=X(n,i);var p=s.refs.get(c);if(!p)throw Error('"refId" not found: '.concat(c));r=p;continue}var v=r.$changes,g=void 0!==r._definition,y=g?f>>6<<6:f;if(y===e.OPERATION.CLEAR){r.clear(o);continue}var m=g?f%(y||255):X(n,i),E=g?r._definition.fieldsByIndex[m]:"",_=v.getType(m),$=void 0,A=void 0,O=void 0;if(g?A=r["_".concat(E)]:(A=r.getByIndex(m),(y&e.OPERATION.ADD)===e.OPERATION.ADD?(O=r instanceof l?q(n,i):m,r.setIndex(m,O)):O=r.getIndex(m)),(y&e.OPERATION.DELETE)===e.OPERATION.DELETE&&(y!==e.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(m),A&&A.$changes&&s.removeRef(A.$changes.refId),$=null),void 0===E){console.warn("@colyseus/schema: definition mismatch");for(var w={offset:i.offset};i.offset<a&&!(Y(n,i)&&(w.offset=i.offset+1,s.refs.has(X(n,w))));)i.offset++;continue}if(y===e.OPERATION.DELETE);else if(t.is(_)){var b=X(n,i);if($=s.refs.get(b),y!==e.OPERATION.REPLACE){var I=this.getSchemaType(n,i,_);!$&&(($=this.createTypeInstance(I)).$changes.refId=b,A&&($.$callbacks=A.$callbacks,A.$changes.refId&&b!==A.$changes.refId&&s.removeRef(A.$changes.refId))),s.addRef(b,$,$!==A)}}else if("string"==typeof _)h=i,$=G[_](n,h);else{var x=d[Object.keys(_)[0]],T=X(n,i),R=s.refs.has(T)?A||s.refs.get(T):new x.constructor;if(($=R.clone(!0)).$changes.refId=T,A&&($.$callbacks=A.$callbacks,A.$changes.refId&&T!==A.$changes.refId)){s.removeRef(A.$changes.refId);for(var P=A.entries(),C=void 0;(C=P.next())&&!C.done;){var S=C.value,D=S[0],k=S[1];o.push({refId:T,op:e.OPERATION.DELETE,field:D,value:void 0,previousValue:k})}}s.addRef(T,$,R!==A)}if(null!=$){if($.$changes&&$.$changes.setParent(v.ref,v.root,m),r instanceof t)r[E]=$;else if(r instanceof l){var D=O;r.$items.set(D,$),r.$changes.allChanges.add(m)}else if(r instanceof u)r.setAt(m,$);else if(r instanceof Q){var N=r.add($);r.setIndex(m,N)}else if(r instanceof Z){var N=r.add($);!1!==N&&r.setIndex(m,N)}}A!==$&&o.push({refId:c,op:y,field:E,dynamicIndex:O,value:$,previousValue:A})}return this._triggerChanges(o),s.garbageCollectDeletedRefs(),o},t.prototype.encode=function(n,i,r){void 0===n&&(n=!1),void 0===i&&(i=[]),void 0===r&&(r=!1);for(var o=this.$changes,s=new WeakSet,a=[o],c=1,h=0;h<c;h++){var f=a[h],u=f.ref,p=u instanceof t;f.ensureRefId(),s.add(f),f!==o&&(f.changed||n)&&(_(i,255),D(i,f.refId));for(var v=n?Array.from(f.allChanges):Array.from(f.changes.values()),g=0,y=v.length;g<y;g++){var m=n?{op:e.OPERATION.ADD,index:v[g]}:v[g],E=m.index,$=p?u._definition.fieldsByIndex&&u._definition.fieldsByIndex[E]:E,A=i.length;if(m.op!==e.OPERATION.TOUCH)if(p)_(i,E|m.op);else{if(_(i,m.op),m.op===e.OPERATION.CLEAR)continue;D(i,E)}if(!p&&(m.op&e.OPERATION.ADD)==e.OPERATION.ADD&&u instanceof l&&S(i,f.ref.$indexes.get(E)),m.op!==e.OPERATION.DELETE){var O=f.getType(E),w=f.getValue(E);if(w&&w.$changes&&!s.has(w.$changes)&&(a.push(w.$changes),w.$changes.ensureRefId(),c++),m.op!==e.OPERATION.TOUCH){if(t.is(O))ei(w,O,u,$),D(i,w.$changes.refId),(m.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(i,O,w.constructor);else if("string"==typeof O)!function(e,t,n,i,r){!function(e,t,n,i){var r,o=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":r="number",isNaN(e)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(i));break;case"string":r="string",o=!0;break;case"boolean":return}if(typeof e!==r&&(!o||o&&null!==e)){var s="'".concat(JSON.stringify(e),"'").concat(e&&e.constructor&&" (".concat(e.constructor.name,")")||"");throw new en("a '".concat(r,"' was expected, but ").concat(s," was provided in ").concat(n.constructor.name,"#").concat(i))}}(n,e,i,r);var o=k[e];if(o)o(t,n);else throw new en("a '".concat(e,"' was expected, but ").concat(n," was provided in ").concat(i.constructor.name,"#").concat(r))}(O,i,w,u,$);else{var b=d[Object.keys(O)[0]];ei(u["_".concat($)],b.constructor,u,$),D(i,w.$changes.refId)}r&&f.cache(E,i.slice(A))}}}n||r||f.discard()}return i},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(n,i){void 0===i&&(i=!1);for(var r,o,s=this,a=new Set,c=ee.get(n),h=[this.$changes],f=1,u=[],d=0;d<f;d++)!function(d){var p=h[d];if(!a.has(p.refId)){var v=p.ref,g=v instanceof t;_(u,255),D(u,p.refId);var y=c.refIds.has(p),m=i||!y;c.addRefId(p);var E=c.containerIndexes.get(p),$=m?Array.from(p.allChanges):Array.from(p.changes.values());!i&&g&&v._definition.indexesWithFilters&&v._definition.indexesWithFilters.forEach(function(t){!E.has(t)&&p.allChanges.has(t)&&(m?$.push(t):$.push({op:e.OPERATION.ADD,index:t}))});for(var A=0,O=$.length;A<O;A++){var w=m?{op:e.OPERATION.ADD,index:$[A]}:$[A];if(w.op===e.OPERATION.CLEAR){_(u,w.op);continue}var b=w.index;if(w.op===e.OPERATION.DELETE){g?_(u,w.op|b):(_(u,w.op),D(u,b));continue}var I=p.getValue(b),x=p.getType(b);if(g){var T=v._definition.filters&&v._definition.filters[b];if(T&&!T.call(v,n,I,s)){I&&I.$changes&&a.add(I.$changes.refId);continue}}else{var R=p.parent,T=p.getChildrenFilter();if(T&&!T.call(R,n,v.$indexes.get(b),I,s)){I&&I.$changes&&a.add(I.$changes.refId);continue}}if(I.$changes&&(h.push(I.$changes),f++),w.op!==e.OPERATION.TOUCH)if(w.op===e.OPERATION.ADD||g)u.push.apply(u,null!=(r=p.caches[b])?r:[]),E.add(b);else if(E.has(b))u.push.apply(u,null!=(o=p.caches[b])?o:[]);else{if(E.add(b),_(u,e.OPERATION.ADD),D(u,b),v instanceof l){var P=p.ref.$indexes.get(b);S(u,P)}I.$changes?D(u,I.$changes.refId):k[x](u,I)}else if(I.$changes&&!g){if(_(u,e.OPERATION.ADD),D(u,b),v instanceof l){var P=p.ref.$indexes.get(b);S(u,P)}D(u,I.$changes.refId)}}}}(d);return u},t.prototype.clone=function(){var e,t=new this.constructor,n=this._definition.schema;for(var i in n)"object"==typeof this[i]&&"function"==typeof(null==(e=this[i])?void 0:e.clone)?t[i]=this[i].clone():t[i]=this[i];return t},t.prototype.toJSON=function(){var e=this._definition.schema,t=this._definition.deprecated,n={};for(var i in e)t[i]||null===this[i]||void 0===this[i]||(n[i]="function"==typeof this[i].toJSON?this[i].toJSON():this["_".concat(i)]);return n},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,t,n){t._typeid!==n._typeid&&(_(e,213),D(e,n._typeid))},t.prototype.getSchemaType=function(e,t,n){var i;return 213===e[t.offset]&&(t.offset++,i=this.constructor._context.get(X(e,t))),i||n},t.prototype.createTypeInstance=function(e){var t=new e;return t.$changes.root=this.$changes.root,t},t.prototype._triggerChanges=function(n){for(var i,r,o,s,a,c,h,f,u,l=new Set,d=this.$changes.root.refs,p=0;p<n.length;p++)!function(p){var v=n[p],g=v.refId,y=d.get(g),m=y.$callbacks;if((v.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&v.previousValue instanceof t&&(null==(r=null==(i=v.previousValue.$callbacks)?void 0:i[e.OPERATION.DELETE])||r.forEach(function(e){return e()})),m){if(y instanceof t){if(!l.has(g))try{null==(o=null==m?void 0:m[e.OPERATION.REPLACE])||o.forEach(function(e){return e()})}catch(e){t.onError(e)}try{m.hasOwnProperty(v.field)&&(null==(s=m[v.field])||s.forEach(function(e){return e(v.value,v.previousValue)}))}catch(e){t.onError(e)}}else v.op===e.OPERATION.ADD&&void 0===v.previousValue?null==(a=m[e.OPERATION.ADD])||a.forEach(function(e){var t;return e(v.value,null!=(t=v.dynamicIndex)?t:v.field)}):v.op===e.OPERATION.DELETE?void 0!==v.previousValue&&(null==(c=m[e.OPERATION.DELETE])||c.forEach(function(e){var t;return e(v.previousValue,null!=(t=v.dynamicIndex)?t:v.field)})):v.op===e.OPERATION.DELETE_AND_ADD&&(void 0!==v.previousValue&&(null==(h=m[e.OPERATION.DELETE])||h.forEach(function(e){var t;return e(v.previousValue,null!=(t=v.dynamicIndex)?t:v.field)})),null==(f=m[e.OPERATION.ADD])||f.forEach(function(e){var t;return e(v.value,null!=(t=v.dynamicIndex)?t:v.field)})),v.value!==v.previousValue&&(null==(u=m[e.OPERATION.REPLACE])||u.forEach(function(e){var t;return e(v.value,null!=(t=v.dynamicIndex)?t:v.field)}));l.add(g)}}(p)},t._definition=p.create(),t}(),eo={context:new v},es=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),r([y("string",eo)],t.prototype,"name",void 0),r([y("string",eo)],t.prototype,"type",void 0),r([y("number",eo)],t.prototype,"referencedType",void 0),t}(er),ea=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new u,t}return i(t,e),r([y("number",eo)],t.prototype,"id",void 0),r([y([es],eo)],t.prototype,"fields",void 0),t}(er),ec=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new u,t}return i(t,e),t.encode=function(e){var n,i=e.constructor,r=new t;r.rootType=i._typeid;var o=null==(n=i._context)?void 0:n.types;for(var s in o){var a=new ea;a.id=Number(s),function(e,t){for(var n in t){var i=new es;i.name=n;var o=void 0;if("string"==typeof t[n])o=t[n];else{var s=t[n],a=void 0;er.is(s)?(o="ref",a=t[n]):(o=Object.keys(s)[0],"string"==typeof s[o]?o+=":"+s[o]:a=s[o]),i.referencedType=a?a._typeid:-1}i.type=o,e.fields.push(i)}r.types.push(e)}(a,o[s]._definition.schema)}return r.encodeAll()},t.decode=function(e,n){var r=new v,o=new t;o.decode(e,n);var s=o.types.reduce(function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(er),o=t.id;return e[o]=n,r.add(n,o),e},{});o.types.forEach(function(e){var t=s[e.id];e.fields.forEach(function(e){var n;if(void 0!==e.referencedType){var i=e.type,o=s[e.referencedType];if(!o){var a=e.type.split(":");i=a[0],o=a[1]}"ref"===i?y(o,{context:r})(t.prototype,e.name):y(((n={})[i]=o,n),{context:r})(t.prototype,e.name)}else y(e.type,{context:r})(t.prototype,e.name)})});var a=s[o.rootType],c=new a;for(var h in a._definition.schema){var f=a._definition.schema[h];"string"!=typeof f&&(c[h]="function"==typeof f?new f:new d[Object.keys(f)[0]].constructor)}return c},r([y([ea],eo)],t.prototype,"types",void 0),r([y("number",eo)],t.prototype,"rootType",void 0),t}(er);d.map={constructor:l},d.array={constructor:u},d.set={constructor:Z},d.collection={constructor:Q},e.ArraySchema=u,e.CollectionSchema=Q,e.Context=v,e.MapSchema=l,e.Reflection=ec,e.ReflectionField=es,e.ReflectionType=ea,e.Schema=er,e.SchemaDefinition=p,e.SetSchema=Z,e.decode=G,e.defineTypes=function(e,t,n){for(var i in void 0===n&&(n={}),n.context||(n.context=e._context||n.context||g),t)y(t[i],n)(e.prototype,i);return e},e.deprecated=function(e){return void 0===e&&(e=!0),function(t,n){var i=t.constructor._definition;i.deprecated[n]=!0,e&&(i.descriptors[n]={get:function(){throw Error("".concat(n," is deprecated."))},set:function(e){},enumerable:!1,configurable:!0})}},e.dumpChanges=function(e){for(var t=[e.$changes],n={},i=0;i<1;i++)!function(e){var i=t[e];i.changes.forEach(function(e){var t=i.ref,r=e.index;n[t._definition?t._definition.fieldsByIndex[r]:t.$indexes.get(r)]=i.getValue(r)})}(i);return n},e.encode=k,e.filter=function(e){return function(t,n){var i=t.constructor;i._definition.addFilter(n,e)&&(i._context.useFilters=!0)}},e.filterChildren=function(e){return function(t,n){var i=t.constructor;i._definition.addChildrenFilter(n,e)&&(i._context.useFilters=!0)}},e.hasFilter=function(e){return e._context&&e._context.useFilters},e.registerType=function(e,t){d[e]=t},e.type=y})(t)},45376:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;let s=o(n(76490)),a=n(50087),c=n(99851),h=n(72620),f=n(49458),u=n(58317),l=n(44616),d=n(53940);class p{constructor(e,t){this.onStateChange=(0,u.createSignal)(),this.onError=(0,u.createSignal)(),this.onLeave=(0,u.createSignal)(),this.onJoin=(0,u.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,f.createNanoEvents)(),this.roomId=null,this.name=e,t&&(this.serializer=new((0,h.getSerializer)("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((e,t)=>{var n;return null==(n=console.warn)?void 0:n.call(console,`colyseus.js - onError => (${e}) ${t}`)}),this.onLeave(()=>this.removeAllListeners())}get id(){return this.roomId}connect(e,t,n=this,i){let r=new a.Connection;n.connection=r,r.events.onmessage=p.prototype.onMessageCallback.bind(n),r.events.onclose=function(e){var i;if(!n.hasJoined){null==(i=console.warn)||i.call(console,`Room connection was closed unexpectedly (${e.code}): ${e.reason}`),n.onError.invoke(e.code,e.reason);return}e.code===d.CloseCode.DEVMODE_RESTART&&t?t():(n.onLeave.invoke(e.code,e.reason),n.destroy())},r.events.onerror=function(e){var t;null==(t=console.warn)||t.call(console,`Room, onError (${e.code}): ${e.reason}`),n.onError.invoke(e.code,e.reason)},r.connect(e,i)}leave(e=!0){return new Promise(t=>{this.onLeave(e=>t(e)),this.connection?e?this.connection.send([c.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(d.CloseCode.CONSENTED)})}onMessage(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)}send(e,t){let n,i=[c.Protocol.ROOM_DATA];if("string"==typeof e?l.encode.string(i,e):l.encode.number(i,e),void 0!==t){let e=s.encode(t);(n=new Uint8Array(i.length+e.byteLength)).set(new Uint8Array(i),0),n.set(new Uint8Array(e),i.length)}else n=new Uint8Array(i);this.connection.send(n.buffer)}sendBytes(e,t){let n,i=[c.Protocol.ROOM_DATA_BYTES];"string"==typeof e?l.encode.string(i,e):l.encode.number(i,e),(n=new Uint8Array(i.length+(t.byteLength||t.length))).set(new Uint8Array(i),0),n.set(new Uint8Array(t),i.length),this.connection.send(n.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(e){let t=Array.from(new Uint8Array(e.data)),n=t[0];if(n===c.Protocol.JOIN_ROOM){let e=1,n=(0,c.utf8Read)(t,e);if(e+=(0,c.utf8Length)(n),this.serializerId=(0,c.utf8Read)(t,e),e+=(0,c.utf8Length)(this.serializerId),!this.serializer){let e=(0,h.getSerializer)(this.serializerId);this.serializer=new e}t.length>e&&this.serializer.handshake&&this.serializer.handshake(t,{offset:e}),this.reconnectionToken=`${this.roomId}:${n}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([c.Protocol.JOIN_ROOM])}else if(n===c.Protocol.ERROR){let e={offset:1},n=l.decode.number(t,e),i=l.decode.string(t,e);this.onError.invoke(n,i)}else if(n===c.Protocol.LEAVE_ROOM)this.leave();else if(n===c.Protocol.ROOM_DATA_SCHEMA){let e={offset:1},n=this.serializer.getState().constructor._context.get(l.decode.number(t,e)),i=new n;i.decode(t,e),this.dispatchMessage(n,i)}else if(n===c.Protocol.ROOM_STATE)t.shift(),this.setState(t);else if(n===c.Protocol.ROOM_STATE_PATCH)t.shift(),this.patch(t);else if(n===c.Protocol.ROOM_DATA){let n={offset:1},i=l.decode.stringCheck(t,n)?l.decode.string(t,n):l.decode.number(t,n),r=t.length>n.offset?s.decode(e.data,n.offset):void 0;this.dispatchMessage(i,r)}else if(n===c.Protocol.ROOM_DATA_BYTES){let e={offset:1},n=l.decode.stringCheck(t,e)?l.decode.string(t,e):l.decode.number(t,e);this.dispatchMessage(n,new Uint8Array(t.slice(e.offset)))}}setState(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())}patch(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(e,t){var n;let i=this.getMessageHandlerKey(e);this.onMessageHandlers.events[i]?this.onMessageHandlers.emit(i,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):null==(n=console.warn)||n.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"function":return`$${e._typeid}`;case"string":return e;case"number":return`i${e}`;default:throw Error("invalid message type.")}}}t.Room=p},46793:e=>{"use strict";e.exports=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},47124:(e,t)=>{"use strict";let n;function i(){if(!n)try{n="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(e){}return n||(n={cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.getItem=t.removeItem=t.setItem=void 0,t.setItem=function(e,t){i().setItem(e,t)},t.removeItem=function(e){i().removeItem(e)},t.getItem=function(e,t){let n=i().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>t(e)):t(n)}},48796:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=e=>null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window)},49458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createNanoEvents=void 0,t.createNanoEvents=()=>({emit(e,...t){let n=this.events[e]||[];for(let e=0,i=n.length;e<i;e++)n[e](...t)},events:{},on(e,t){var n;return(null==(n=this.events[e])?void 0:n.push(t))||(this.events[e]=[t]),()=>{var n;this.events[e]=null==(n=this.events[e])?void 0:n.filter(e=>t!==e)}}})},50087:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;let i=n(82125);class r{constructor(){this.events={},this.transport=new i.WebSocketTransport(this.events)}send(e){this.transport.send(e)}connect(e,t){this.transport.connect(e,t)}close(e,t){this.transport.close(e,t)}get isOpen(){return this.transport.isOpen}}t.Connection=r},53940:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=t.CloseCode=void 0,function(e){e[e.CONSENTED=4e3]="CONSENTED",e[e.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(t.CloseCode||(t.CloseCode={}));class n extends Error{constructor(e,t){super(t),this.name="ServerError",this.code=e}}t.ServerError=n},56324:function(e,t,n){"use strict";var i,r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=t.MatchMakeError=void 0;let o=n(53940),s=n(45376),a=n(64707),c=n(23257),h=n(63054);class f extends Error{constructor(e,t){super(e),this.code=t,Object.setPrototypeOf(this,f.prototype)}}t.MatchMakeError=f;let u="undefined"!=typeof window&&void 0!==(null==(i=null==window?void 0:window.location)?void 0:i.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class l{constructor(e=u,t){var n,i;if("string"==typeof e){let t=e.startsWith("/")?new URL(e,u):new URL(e),n="https:"===t.protocol||"wss:"===t.protocol,i=Number(t.port||(n?443:80));this.settings={hostname:t.hostname,pathname:t.pathname,port:i,secure:n}}else void 0===e.port&&(e.port=e.secure?443:80),void 0===e.pathname&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new a.HTTP(this,(null==t?void 0:t.headers)||{}),this.auth=new c.Auth(this.http),this.urlBuilder=null==t?void 0:t.urlBuilder,!this.urlBuilder&&"undefined"!=typeof window&&(null==(i=null==(n=null==window?void 0:window.location)?void 0:n.hostname)?void 0:i.includes("discordsays.com"))&&(this.urlBuilder=h.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e,t={},n){return r(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("joinOrCreate",e,t,n)})}create(e,t={},n){return r(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("create",e,t,n)})}join(e,t={},n){return r(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("join",e,t,n)})}joinById(e,t={},n){return r(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("joinById",e,t,n)})}reconnect(e,t){return r(this,void 0,void 0,function*(){if("string"==typeof e&&"string"==typeof t)throw Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");let[n,i]=e.split(":");if(!n||!i)throw Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",n,{reconnectionToken:i},t)})}getAvailableRooms(e=""){return r(this,void 0,void 0,function*(){return(yield this.http.get(`matchmake/${e}`,{headers:{Accept:"application/json"}})).data})}consumeSeatReservation(e,t,n){return r(this,void 0,void 0,function*(){let i=this.createRoom(e.room.name,t);i.roomId=e.room.roomId,i.sessionId=e.sessionId;let s={sessionId:i.sessionId};e.reconnectionToken&&(s.reconnectionToken=e.reconnectionToken);let a=n||i;return i.connect(this.buildEndpoint(e.room,s),e.devMode&&(()=>r(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${i.roomId}'...`);let n=0,o=()=>r(this,void 0,void 0,function*(){n++;try{yield this.consumeSeatReservation(e,t,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${i.roomId}'`)}catch(e){n<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${n} out of 8)`),setTimeout(o,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(o,2e3)})),a,this.http.headers),new Promise((e,t)=>{let n=(e,n)=>t(new o.ServerError(e,n));a.onError.once(n),a.onJoin.once(()=>{a.onError.remove(n),e(a)})})})}createMatchMakeRequest(e,t,n={},i,o){return r(this,void 0,void 0,function*(){let r=(yield this.http.post(`matchmake/${e}/${t}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})).data;if(r.error)throw new f(r.error,r.code);return"reconnect"===e&&(r.reconnectionToken=n.reconnectionToken),yield this.consumeSeatReservation(r,i,o)})}createRoom(e,t){return new s.Room(e,t)}buildEndpoint(e,t={}){let n=[];for(let e in t)t.hasOwnProperty(e)&&n.push(`${e}=${t[e]}`);let i=this.settings.secure?"wss://":"ws://";e.publicAddress?i+=`${e.publicAddress}`:i+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;let r=`${i}/${e.processId}/${e.roomId}?${n.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getHttpEndpoint(e=""){let t=e.startsWith("/")?e:`/${e}`,n=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(n)):n}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}t.Client=l},58317:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSignal=t.EventEmitter=void 0;class n{constructor(){this.handlers=[]}register(e,t=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach(t=>t.apply(this,e))}invokeAsync(...e){return Promise.all(this.handlers.map(t=>t.apply(this,e)))}remove(e){let t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}t.EventEmitter=n,t.createSignal=function(){let e=new n;function t(t){return e.register(t,this===null)}return t.once=t=>{let n=function(...i){t.apply(this,i),e.remove(n)};e.register(n)},t.remove=t=>e.remove(t),t.invoke=(...t)=>e.invoke(...t),t.invokeAsync=(...t)=>e.invokeAsync(...t),t.clear=()=>e.clear(),t}},63054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.discordURLBuilder=void 0,t.discordURLBuilder=function(e){var t;let n=(null==(t=null==window?void 0:window.location)?void 0:t.hostname)||"localhost",i=e.hostname.split("."),r=e.hostname.includes("trycloudflare.com")||e.hostname.includes("discordsays.com")||!(i.length>2)?"":`/${i[0]}`;return e.pathname.startsWith("/.proxy")?`${e.protocol}//${n}${r}${e.pathname}${e.search}`:`${e.protocol}//${n}/.proxy/colyseus${r}${e.pathname}${e.search}`}},63095:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaSerializer=void 0;let i=n(44616);class r{setState(e){return this.state.decode(e)}getState(){return this.state}patch(e){return this.state.decode(e)}teardown(){var e,t;null==(t=null==(e=this.state)?void 0:e.$changes)||t.root.clearRefs()}handshake(e,t){this.state?new i.Reflection().decode(e,t):this.state=i.Reflection.decode(e,t)}}t.SchemaSerializer=r},64707:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HTTP=void 0;let s=n(53940),a=o(n(64879));class c{constructor(e,t={}){this.client=e,this.headers=t}get(e,t={}){return this.request("get",e,t)}post(e,t={}){return this.request("post",e,t)}del(e,t={}){return this.request("del",e,t)}put(e,t={}){return this.request("put",e,t)}request(e,t,n={}){return a[e](this.client.getHttpEndpoint(t),this.getOptions(n)).catch(e=>{var t;let n=e.statusCode,i=(null==(t=e.data)?void 0:t.error)||e.statusMessage||e.message;if(!n&&!i)throw e;throw new s.ServerError(n,i)})}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!=typeof cc&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}}t.HTTP=c},64879:(e,t,n)=>{"use strict";function i(e,t){t.headers=e.headers||{},t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.response}function r(e,t,n){return new Promise(function(r,o){n=n||{};var s,a,c,h=new XMLHttpRequest,f=n.body,u=n.headers||{};for(s in n.timeout&&(h.timeout=n.timeout),h.ontimeout=h.onerror=function(e){e.timeout="timeout"==e.type,o(e)},h.open(e,t.href||t),h.onload=function(){for(c=h.getAllResponseHeaders().trim().split(/[\r\n]+/),i(h,h);a=c.shift();)a=a.split(": "),h.headers[a.shift().toLowerCase()]=a.join(": ");if((a=h.headers["content-type"])&&~a.indexOf("application/json"))try{h.data=JSON.parse(h.data,n.reviver)}catch(e){return i(h,e),o(e)}(h.status>=400?o:r)(h)},"u">typeof FormData&&f instanceof FormData||f&&"object"==typeof f&&(u["content-type"]="application/json",f=JSON.stringify(f)),h.withCredentials=!!n.withCredentials,u)h.setRequestHeader(s,u[s]);h.send(f)})}n.r(t),n.d(t,{del:()=>c,get:()=>o,patch:()=>a,post:()=>s,put:()=>h,send:()=>r});var o=r.bind(r,"GET"),s=r.bind(r,"POST"),a=r.bind(r,"PATCH"),c=r.bind(r,"DELETE"),h=r.bind(r,"PUT")},72620:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSerializer=t.registerSerializer=void 0;let n={};t.registerSerializer=function(e,t){n[e]=t},t.getSerializer=function(e){let t=n[e];if(!t)throw Error("missing serializer: "+e);return t}},76490:(e,t)=>{"use strict";function n(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else if(ArrayBuffer.isView(e))this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength);else throw Error("Invalid argument")}Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0,n.prototype._array=function(e){for(var t=Array(e),n=0;n<e;n++)t[n]=this._parse();return t},n.prototype._map=function(e){for(var t="",n={},i=0;i<e;i++)n[this._parse()]=this._parse();return n},n.prototype._str=function(e){var t=function(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e.getUint8(o);if((128&a)==0){i+=String.fromCharCode(a);continue}if((224&a)==192){i+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));continue}if((240&a)==224){i+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|63&e.getUint8(++o));continue}if((248&a)==240){(r=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|63&e.getUint8(++o))>=65536?(r-=65536,i+=String.fromCharCode((r>>>10)+55296,(1023&r)+56320)):i+=String.fromCharCode(r);continue}throw Error("Invalid byte "+a.toString(16))}return i}(this._view,this._offset,e);return this._offset+=e,t},n.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},n.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,i=0,r=0,o=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-((255-t+1)*1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),i=this._view.getInt8(this._offset+1),this._offset+=2,-1===i){var s=this._view.getUint32(this._offset);return r=this._view.getInt32(this._offset+4),o=this._view.getUint32(this._offset+8),this._offset+=12,new Date((0x100000000*r+o)*1e3+s/1e6)}return[i,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),i=this._view.getInt8(this._offset+2),this._offset+=3,[i,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),i=this._view.getInt8(this._offset+4),this._offset+=5,[i,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return r=0x100000000*this._view.getUint32(this._offset),o=this._view.getUint32(this._offset+4),this._offset+=8,r+o;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return r=0x100000000*this._view.getInt32(this._offset),o=this._view.getUint32(this._offset+4),this._offset+=8,r+o;case 212:if(i=this._view.getInt8(this._offset),this._offset+=1,0===i){this._offset+=1;return}return[i,this._bin(1)];case 213:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(2)];case 214:if(i=this._view.getInt8(this._offset),this._offset+=1,-1===i)return e=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*e);return[i,this._bin(4)];case 215:if(i=this._view.getInt8(this._offset),this._offset+=1,0===i)return r=0x100000000*this._view.getInt32(this._offset),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+o);if(-1===i)return r=this._view.getUint32(this._offset),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*((3&r)*0x100000000+o)+(r>>>2)/1e6);return[i,this._bin(8)];case 216:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw Error("Could not parse")},t.decode=function(e,t=0){var i=new n(e,t),r=i._parse();if(i._offset!==e.byteLength)throw Error(e.byteLength-i._offset+" trailing bytes");return r},t.encode=function(e){var t=[],n=[],i=new ArrayBuffer(function e(t,n,i){var r=typeof i,o=0,s=0,a=0,c=0,h=0,f=0;if("string"===r){if((h=function(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(i))<32)t.push(160|h),f=1;else if(h<256)t.push(217,h),f=2;else if(h<65536)t.push(218,h>>8,h),f=3;else if(h<0x100000000)t.push(219,h>>24,h>>16,h>>8,h),f=5;else throw Error("String too long");return n.push({_str:i,_length:h,_offset:t.length}),f+h}if("number"===r)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(t.push(i),1):i<256?(t.push(204,i),2):i<65536?(t.push(205,i>>8,i),3):i<0x100000000?(t.push(206,i>>24,i>>16,i>>8,i),5):(a=i/0x100000000|0,c=i>>>0,t.push(207,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),9):i>=-32?(t.push(i),1):i>=-128?(t.push(208,i),2):i>=-32768?(t.push(209,i>>8,i),3):i>=-0x80000000?(t.push(210,i>>24,i>>16,i>>8,i),5):(a=Math.floor(i/0x100000000),c=i>>>0,t.push(211,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),9):(t.push(203),n.push({_float:i,_length:8,_offset:t.length}),9);if("object"===r){if(null===i)return t.push(192),1;if(Array.isArray(i)){if((h=i.length)<16)t.push(144|h),f=1;else if(h<65536)t.push(220,h>>8,h),f=3;else if(h<0x100000000)t.push(221,h>>24,h>>16,h>>8,h),f=5;else throw Error("Array too large");for(o=0;o<h;o++)f+=e(t,n,i[o]);return f}if(i instanceof Date){var u=i.getTime(),l=Math.floor(u/1e3),d=(u-1e3*l)*1e6;return l>=0&&d>=0&&l<=0x3ffffffff?0===d&&l<=0xffffffff?(t.push(214,255,l>>24,l>>16,l>>8,l),6):(a=l/0x100000000,c=0|l,t.push(215,255,d>>22,d>>14,d>>6,a,c>>24,c>>16,c>>8,c),10):(a=Math.floor(l/0x100000000),c=l>>>0,t.push(199,12,255,d>>24,d>>16,d>>8,d,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),15)}if(i instanceof ArrayBuffer){if((h=i.byteLength)<256)t.push(196,h),f=2;else if(h<65536)t.push(197,h>>8,h),f=3;else if(h<0x100000000)t.push(198,h>>24,h>>16,h>>8,h),f=5;else throw Error("Buffer too large");return n.push({_bin:i,_length:h,_offset:t.length}),f+h}if("function"==typeof i.toJSON)return e(t,n,i.toJSON());var p=[],v="",g=Object.keys(i);for(o=0,s=g.length;o<s;o++)void 0!==i[v=g[o]]&&"function"!=typeof i[v]&&p.push(v);if((h=p.length)<16)t.push(128|h),f=1;else if(h<65536)t.push(222,h>>8,h),f=3;else if(h<0x100000000)t.push(223,h>>24,h>>16,h>>8,h),f=5;else throw Error("Object too large");for(o=0;o<h;o++)f+=e(t,n,v=p[o]),f+=e(t,n,i[v]);return f}if("boolean"===r)return t.push(i?195:194),1;if("undefined"===r)return t.push(192),1;if("function"==typeof i.toJSON)return e(t,n,i.toJSON());throw Error("Could not encode")}(t,n,e)),r=new DataView(i),o=0,s=0,a=-1;n.length>0&&(a=n[0]._offset);for(var c,h=0,f=0,u=0,l=t.length;u<l;u++)if(r.setUint8(s+u,t[u]),u+1===a){if(h=(c=n[o])._length,f=s+a,c._bin)for(var d=new Uint8Array(c._bin),p=0;p<h;p++)r.setUint8(f+p,d[p]);else c._str?function(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)(i=n.charCodeAt(r))<128?e.setUint8(t++,i):(i<2048?e.setUint8(t++,192|i>>6):(i<55296||i>=57344?e.setUint8(t++,224|i>>12):(r++,i=65536+((1023&i)<<10|1023&n.charCodeAt(r)),e.setUint8(t++,240|i>>18),e.setUint8(t++,128|i>>12&63)),e.setUint8(t++,128|i>>6&63)),e.setUint8(t++,128|63&i))}(r,f,c._str):void 0!==c._float&&r.setFloat64(f,c._float);o++,s+=h,n[o]&&(a=n[o]._offset)}return i}},81597:(e,t,n)=>{"use strict";t.Kj=void 0,n(48796);var i=n(56324);Object.defineProperty(t,"Kj",{enumerable:!0,get:function(){return i.Client}}),n(99851),n(45376),n(23257);let r=n(63095),o=n(22630),s=n(72620);(0,s.registerSerializer)("schema",r.SchemaSerializer),(0,s.registerSerializer)("none",o.NoneSerializer)},82125:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketTransport=void 0;let r=i(n(46793)),o=globalThis.WebSocket||r.default;class s{constructor(e){this.events=e}send(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)}connect(e,t){try{this.ws=new o(e,{headers:t,protocols:this.protocols})}catch(t){this.ws=new o(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,t){this.ws.close(e,t)}get isOpen(){return this.ws.readyState===o.OPEN}}t.WebSocketTransport=s},99851:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utf8Length=t.utf8Read=t.ErrorCode=t.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(t.Protocol||(t.Protocol={})),function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(t.ErrorCode||(t.ErrorCode={})),t.utf8Read=function(e,t){let n=e[t++];for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];if((128&a)==0){i+=String.fromCharCode(a);continue}if((224&a)==192){i+=String.fromCharCode((31&a)<<6|63&e[++o]);continue}if((240&a)==224){i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|63&e[++o]);continue}if((248&a)==240){(r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|63&e[++o])>=65536?(r-=65536,i+=String.fromCharCode((r>>>10)+55296,(1023&r)+56320)):i+=String.fromCharCode(r);continue}throw Error("Invalid byte "+a.toString(16))}return i},t.utf8Length=function(e=""){let t=0,n=0;for(let i=0,r=e.length;i<r;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n+1}}}]);