(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8166],{3998:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(95155),s=r(12115),l=r(32467),o=r(83101),n=r(64269);let i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:o,asChild:c=!1,...d}=e,u=c?l.DX:"button";return(0,a.jsx)(u,{className:(0,n.cn)(i({variant:s,size:o,className:r})),ref:t,...d})});c.displayName="Button"},5917:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},16190:(e,t,r)=>{"use strict";r.d(t,{default:()=>j});var a=r(95155),s=r(12115),l=r(20063),o=r(3998),n=r(86948),i=r(91169),c=r(56154),d=r(26983),u=r(5917);let m=(0,r(71847).A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var x=r(86651),h=r(35299),f=r(85921),p=r(65229),b=r(74744),g=r(1733),v=r(26497),y=r(81597);let j=e=>{let{userId:t,username:r,rating:j}=e,N=(0,l.useSearchParams)(),w=(null==N?void 0:N.get("private"))==="true",k=null==N?void 0:N.get("roomCode"),[C,A]=(0,s.useState)("waiting"),[R,S]=(0,s.useState)(null),[M,P]=(0,s.useState)({playersInQueue:0,ongoingMatches:0,averageWaitTime:0}),[E,F]=(0,s.useState)(null),[L,I]=(0,s.useState)(!1),[T,_]=(0,s.useState)(!1),[z,q]=(0,s.useState)([]),[B,W]=(0,s.useState)(null),[$,Q]=(0,s.useState)("All"),[Z,O]=(0,s.useState)(""),[D,H]=(0,s.useState)(!1),U=(0,l.useRouter)(),J=(0,s.useRef)(null),V=(0,s.useRef)(!0),G=(0,s.useRef)(!1),K=(0,s.useRef)(!1),Y=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=!0;if(w&&k){if(J.current)return void console.log("Private room already connected, using existing connection");let a=async()=>{try{console.log("Starting private room join process...");let a="http://localhost:2567";console.log("Fetching room info for code: ".concat(k));let s=await fetch("".concat(a,"/private/join"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomCode:k,userId:t,username:r})});if(!s.ok){let e=await s.json();throw console.error("HTTP join request failed:",e),Error(e.error||"Failed to join room")}let l=await s.json();if(console.log("Received room info:",l),!e)return;if(!l.roomId)throw Error("Room ID not found in response");let o=(null==l?void 0:l.isCreator)===!0||(null==l?void 0:l.role)==="creator";_(o),K.current=!0;try{let s=await fetch("".concat(a,"/private/state?roomCode=").concat(encodeURIComponent(k)));if(s.ok){let a=await s.json();if(!e)return;F({roomCode:a.roomCode,players:a.players||[{userId:t,username:r}],isCreator:o})}else F({roomCode:k,players:[{userId:t,username:r}],isCreator:!!l.isCreator})}catch(e){F({roomCode:k,players:[{userId:t,username:r}],isCreator:!!l.isCreator})}V.current=!1;try{let e=await fetch("".concat(a,"/private/state?roomCode=").concat(encodeURIComponent(k)));if(e.ok){let r=await e.json();(null==r?void 0:r.players)&&(F({roomCode:k,players:r.players,isCreator:r.creatorId===t}),_(r.creatorId===t))}}catch(e){}G.current=!0;let n=async()=>{try{let r=await fetch("".concat("http://localhost:2567","/private/state?roomCode=").concat(encodeURIComponent(k)));if(r.ok){let a=await r.json();if(!e)return;(null==a?void 0:a.players)&&(F({roomCode:k,players:a.players,isCreator:K.current?T:a.creatorId===t}),K.current||_(a.creatorId===t))}}catch(e){}e&&G.current&&setTimeout(n,2e3)};n();let i=new y.Kj("ws://localhost:2567"),c=new Promise((e,t)=>{setTimeout(()=>{t(Error("Connection timeout: Room setup took too long. Please try again."))},1e4)}),d=null,u=null,m=[500,1e3,2e3,3e3],x=async e=>{console.log("Join attempt ".concat(e+1,"/").concat(5,"..."));try{let e=i.joinById(l.roomId,{roomCode:k,userId:t,username:r});return await Promise.race([e,c])}catch(a){let t=a instanceof Error?a:Error(String(a)),r=t.message.toLowerCase();if(console.log("Join attempt ".concat(e+1," failed:"),r),(r.includes("locked")||r.includes("room")||r.includes("not found")&&e<4)&&e<4)return console.log("Retrying in ".concat(m[e],"ms...")),await new Promise(t=>setTimeout(t,m[e])),x(e+1);throw t}};try{d=await Promise.race([x(0),c]),console.log("Successfully connected to room:",d.id)}catch(e){throw u=e instanceof Error?e:Error(String(e)),console.error("Failed to join room after all attempts:",u),u}if(!d)throw u||Error("Failed to join room after retries");J.current=d,_(l.isCreator),V.current=!1,F({roomCode:k,players:[{userId:t,username:r}],isCreator:l.isCreator}),d.onMessage("room_info",r=>{e&&(F({roomCode:r.roomCode,players:r.players||[],isCreator:r.creatorId===t}),K.current||_(r.creatorId===t))}),d.onMessage("problem_selected",t=>{if(!e)return;let r=z.find(e=>e._id===t.problemId);r&&(W(r),b.oR.success("Problem selected: ".concat(r.title)))}),d.onMessage("match_started",t=>{e&&(console.log("Match started:",t),V.current=!1,b.oR.success("Match starting!"),U.push("/match"))}),d.onMessage("error",t=>{e&&b.oR.error(t.message)}),console.log("Successfully connected to private room via WebSocket")}catch(t){let e=t instanceof Error?t.message:"Failed to join room";console.error("Failed to join private room:",t),b.oR.error("Failed to join room: "+e),A("error"),S(e)}finally{Y.current=null}};return Y.current||(Y.current=a().catch(()=>{}).finally(()=>{Y.current=null})),()=>{e=!1,G.current=!1,J.current&&V.current&&(console.log("Leaving private room due to component unmount"),J.current.leave())}}{let r=async()=>{try{let e="http://localhost:2567",[t,r]=await Promise.all([fetch("".concat(e,"/queue/size")),fetch("".concat(e,"/global/general-stats"))]),a=t.ok?await t.json():{size:0},s=r.ok?await r.json():{inProgressMatches:0};P({playersInQueue:"number"==typeof a.size?a.size:0,ongoingMatches:"number"==typeof s.inProgressMatches?s.inProgressMatches:0,averageWaitTime:10})}catch(e){P({playersInQueue:0,ongoingMatches:0,averageWaitTime:10})}};(async()=>{try{console.log("Connecting to queue room...",t,j);let r=new y.Kj("ws://localhost:2567"),a=await r.joinOrCreate("queue",{userId:t,rating:j});J.current=a,console.log("Joined queue room:",a.id),a.onMessage("match_found",e=>{console.log("Match found!",e),A("matched"),V.current=!1;try{a.leave()}catch(e){}U.push("/match")}),a.onMessage("already_in_match",e=>{console.log("Already in active match:",e),V.current=!1,b.oR.info("Redirecting to your active match...");try{a.leave()}catch(e){}U.push("/match")}),a.onError((e,t)=>{console.error("Queue room error:",e,t),b.oR.error("Queue error: "+t),A("error")}),a.onLeave(t=>{console.log("Left queue room:",t),V.current&&e&&A("cancelled")})}catch(e){console.error("Failed to join queue:",e),b.oR.error("Failed to join queue."),A("error")}})(),r();let a=setInterval(r,5e3);return()=>{if(e=!1,clearInterval(a),J.current&&V.current)try{J.current.leave()}catch(e){}}}},[t,r,j,U,w,k,z]),(0,s.useEffect)(()=>{let e=()=>{if(J.current&&V.current)try{J.current.leave(),console.log("Left queue room on page unload")}catch(e){}if(w&&k&&V.current)try{if(navigator.sendBeacon){let e=JSON.stringify({userId:t});navigator.sendBeacon("".concat("http://localhost:2567","/private/leave"),e),console.log("Sent private room leave via sendBeacon")}}catch(e){}J.current=null},r=()=>{if("hidden"===document.visibilityState&&J.current&&V.current)try{J.current.leave(),console.log("Left queue room on page hidden")}catch(e){}};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",r)}},[w,k,t]),(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("http://localhost:2567","/problems/list"));if(e.ok){let t=await e.json();q(t.problems||[])}}catch(e){console.error("Failed to fetch problems:",e)}};w&&e()},[w]);let X=z.filter(e=>{let t="All"===$||e.difficulty===$,r=e.title.toLowerCase().includes(Z.toLowerCase());return t&&r}),ee=async()=>{try{if(V.current=!1,A("cancelled"),w&&k){if(J.current)try{await J.current.leave()}catch(e){console.warn("Failed to leave private room:",e)}}else if(J.current)try{await J.current.leave()}catch(e){console.warn("Failed to leave queue room:",e)}U.push("/play")}catch(e){console.error("Error cancelling queue:",e),A("error"),S("Failed to cancel queue. Please try again.")}},et={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.5,staggerChildren:.2}}},er={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4}}};return(0,a.jsxs)("div",{className:"min-h-screen bg-blue-50 p-4 sm:p-8 relative overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute inset-0 overflow-hidden opacity-10",children:[(0,a.jsx)("div",{className:"absolute left-0 top-0 h-[500px] w-[500px] bg-blue-400 rounded-full filter blur-3xl"}),(0,a.jsx)("div",{className:"absolute right-0 bottom-0 h-[500px] w-[500px] bg-cyan-400 rounded-full filter blur-3xl"})]}),(0,a.jsx)(g.P.div,{className:"relative z-10 max-w-5xl mx-auto flex items-center justify-center min-h-screen",variants:et,initial:"hidden",animate:"visible",children:(0,a.jsxs)("div",{className:"w-full space-y-8",children:[!w&&(0,a.jsx)(g.P.div,{variants:er,children:(0,a.jsxs)(n.Zp,{className:"bg-white/90 border-blue-200 shadow-xl",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-2xl font-bold text-center text-black",children:"Queue Statistics"})}),(0,a.jsxs)(n.Wu,{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(i.A,{className:"h-8 w-8 mx-auto mb-2",style:{color:"#2599D4"}}),(0,a.jsx)("p",{className:"text-2xl font-bold text-black",children:M.playersInQueue}),(0,a.jsx)("p",{className:"text-sm text-black/70",children:"Players in Queue"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(c.A,{className:"h-8 w-8 mx-auto mb-2 text-yellow-600"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-black",children:M.ongoingMatches}),(0,a.jsx)("p",{className:"text-sm text-black/70",children:"Ongoing Matches"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(d.A,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-black",children:[M.averageWaitTime,"s"]}),(0,a.jsx)("p",{className:"text-sm text-black/70",children:"Avg. Wait Time"})]})]})]})}),(0,a.jsx)(v.N,{mode:"wait",children:(0,a.jsx)(g.P.div,{variants:et,initial:"hidden",animate:"visible",exit:"hidden",children:(0,a.jsxs)(n.Zp,{className:"bg-white/90 border-blue-200 shadow-xl overflow-hidden",children:[(0,a.jsx)(n.aR,{className:"bg-white/50",children:(0,a.jsxs)(n.ZB,{className:"text-2xl font-bold text-center text-black",children:[w?"Private Room":"Finding Match","matched"===C&&" - Match Found!","error"===C&&" - Error","cancelled"===C&&" - Cancelled"]})}),(0,a.jsx)(n.Wu,{className:"p-8",children:(0,a.jsxs)(g.P.div,{variants:er,children:["waiting"===C&&(0,a.jsx)(a.Fragment,{children:w?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6 border-2 border-blue-200",children:[(0,a.jsx)("p",{className:"text-sm text-black/70 mb-2 text-center",children:"Room Code"}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,a.jsx)("p",{className:"text-4xl font-bold text-black tracking-wider",children:k}),(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{k&&(navigator.clipboard.writeText(k),I(!0),b.oR.success("Room code copied to clipboard!"),setTimeout(()=>I(!1),2e3))},className:"ml-2",children:L?(0,a.jsx)(u.A,{className:"h-4 w-4"}):(0,a.jsx)(m,{className:"h-4 w-4"})})]}),(0,a.jsx)("p",{className:"text-xs text-black/60 mt-2 text-center",children:"Share this code with your friend to join"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-lg font-semibold text-black mb-3",children:["Players (",((null==E?void 0:E.players)||[{userId:t,username:r}]).length,"/2)"]}),(0,a.jsx)("div",{className:"space-y-2",children:((null==E?void 0:E.players)||[{userId:t,username:r}]).map((e,r)=>(0,a.jsx)("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 border border-blue-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.A,{className:"h-5 w-5 text-blue-500"}),(0,a.jsx)("span",{className:"font-medium text-black",children:e.username}),e.userId===t&&(0,a.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:"You"})]})},r))})]}),T&&(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-blue-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-black mb-4",children:"Select Problem"}),B?(0,a.jsxs)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"Selected Problem:"}),(0,a.jsx)("p",{className:"text-black font-semibold",children:B.title}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat("Easy"===B.difficulty?"bg-green-100 text-green-700":"Medium"===B.difficulty?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:B.difficulty}),B.topics.slice(0,2).map((e,t)=>(0,a.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:e},t))]})]}):(0,a.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-yellow-700",children:"No problem selected - will use random Medium problem"})}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-black mb-2",children:"Filter by Difficulty:"}),(0,a.jsx)("div",{className:"flex gap-2",children:["All","Easy","Medium","Hard"].map(e=>(0,a.jsx)(o.$,{variant:$===e?"default":"outline",size:"sm",onClick:()=>Q(e),className:$===e?"bg-blue-500 text-white":"",children:e},e))})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)("input",{type:"text",placeholder:"Search problems...",value:Z,onChange:e=>O(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:X.map(e=>(0,a.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat((null==B?void 0:B._id)===e._id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 hover:bg-blue-50"),onClick:()=>{T&&J.current&&J.current.send("select_problem",{userId:t,problemId:e._id})},children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-black",children:e.title}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat("Easy"===e.difficulty?"bg-green-100 text-green-700":"Medium"===e.difficulty?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:e.difficulty}),e.topics.slice(0,3).map((e,t)=>(0,a.jsx)("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:e},t))]})]}),(null==B?void 0:B._id)===e._id&&(0,a.jsx)(u.A,{className:"h-5 w-5 text-blue-500"})]})},e._id))})]}),T&&(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(o.$,{className:"px-8 py-3 text-white font-semibold rounded-full transition-all duration-300 ".concat(2===((null==E?void 0:E.players)||[]).length?"bg-green-500 hover:bg-green-600 transform hover:scale-105":"bg-gray-400 cursor-not-allowed"),onClick:()=>{T&&J.current&&(null==E?void 0:E.players.length)===2&&(H(!0),J.current.send("start_match",{userId:t}))},disabled:2!==((null==E?void 0:E.players)||[]).length||D,children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.A,{className:"mr-2 h-5 w-5 animate-spin"}),"Starting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.A,{className:"mr-2 h-5 w-5"}),"Start Match"]})})}),T?(0,a.jsx)("p",{className:"text-center text-black/60",children:2===((null==E?void 0:E.players)||[]).length?"Ready to start the match!":"Waiting for another player to join..."}):(0,a.jsx)("p",{className:"text-center text-black/60",children:B?"Host selected: ".concat(B.title):"Host is selecting a problem..."}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)(o.$,{variant:"outline",className:"px-6 py-3 text-black font-semibold rounded-full border-2 border-red-500 text-red-500",onClick:ee,children:[(0,a.jsx)(p.A,{className:"mr-2 h-5 w-5"}),"Leave Room"]})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.A,{className:"h-20 w-20 animate-spin text-blue-500"}),(0,a.jsx)(i.A,{className:"h-10 w-10 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-slate-200"})]})}),(0,a.jsx)("p",{className:"text-center mb-6 text-xl text-black/70",children:w?"Setting up private room...":"Searching for an opponent..."}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)(o.$,{className:"px-6 py-3 text-white font-semibold rounded-full transition-colors duration-300 flex items-center text-lg",onClick:ee,style:{backgroundColor:"#dc2626"},children:[(0,a.jsx)(p.A,{className:"mr-2 h-5 w-5"}),"Cancel"]})})]})}),"error"===C&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-center mb-6 text-xl text-red-600",children:R||"An error occurred"}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(o.$,{className:"px-6 py-3 text-white font-semibold rounded-full transition-colors duration-300 text-lg",onClick:()=>U.push("/play"),style:{backgroundColor:"#2599D4"},children:"Back to Play"})})]})]})})]})},C)})]})})]})}},17037:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var a=r(95155),s=r(12115),l=r(59034),o=r(64269);let n=s.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsxs)(l.bL,{className:(0,o.cn)("relative overflow-hidden",r),children:[(0,a.jsx)(l.LM,{ref:t,...n,className:"h-full w-full rounded-[inherit]",children:s}),(0,a.jsx)(i,{}),(0,a.jsx)(l.OK,{})]})});n.displayName=l.bL.displayName;let i=s.forwardRef((e,t)=>{let{className:r,orientation:s="vertical",...n}=e;return(0,a.jsx)(l.VM,{ref:t,orientation:s,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...n,children:(0,a.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});i.displayName=l.VM.displayName},26983:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},30926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{callServer:function(){return a.callServer},createServerReference:function(){return l.createServerReference},findSourceMapURL:function(){return s.findSourceMapURL}});let a=r(41209),s=r(85153),l=r(77197)},35299:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},56154:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},57297:(e,t,r)=>{Promise.resolve().then(r.bind(r,93080)),Promise.resolve().then(r.bind(r,83383)),Promise.resolve().then(r.bind(r,16190))},64269:(e,t,r)=>{"use strict";r.d(t,{T:()=>o,cn:()=>l});var a=r(2821),s=r(75889);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}function o(e){if(e)return"".concat("http://localhost:9000/codeclashers-avatars/").concat(e)}},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},83383:(e,t,r)=>{"use strict";r.d(t,{default:()=>g});var a=r(95155),s=r(12115),l=r(20063),o=r(3998),n=r(86948),i=r(91169),c=r(56154),d=r(26983),u=r(35299),m=r(65229),x=r(74744),h=r(1733),f=r(26497),p=r(30926);let b=(0,p.createServerReference)("0034fb2acf4858674bf1397e7556b98e6b210e13fd",p.callServer,void 0,p.findSourceMapURL,"createGuestMatch"),g=e=>{let{isAlreadyPlayed:t}=e,[r,p]=(0,s.useState)("waiting"),[g,v]=(0,s.useState)(null),[y,j]=(0,s.useState)({playersInQueue:0,ongoingMatches:0,averageWaitTime:0}),[N,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),A=(0,l.useRouter)();(0,s.useEffect)(()=>{if(t)return void p("cancelled");k||(async()=>{try{w(!0),C(!0);let e=await b();if(!e.success)throw Error(e.error||"Failed to create guest match");e.guestId&&(document.cookie="codeclashers.guest.sid=".concat(e.guestId,"; path=/; max-age=").concat(604800,"; samesite=lax")),p("waiting");try{let e="http://localhost:2567",[t,r]=await Promise.all([fetch("".concat(e,"/queue/size")),fetch("".concat(e,"/global/general-stats"))]),a=t.ok?await t.json():{size:0},s=r.ok?await r.json():{inProgressMatches:0};j({playersInQueue:"number"==typeof a.size?a.size:0,ongoingMatches:"number"==typeof s.inProgressMatches?s.inProgressMatches:0,averageWaitTime:3})}catch(e){j({playersInQueue:0,ongoingMatches:0,averageWaitTime:3})}setTimeout(()=>{p("matched"),setTimeout(()=>{A.push("/match")},500)},1e3)}catch(t){console.error("Failed to create guest match:",t);let e=t instanceof Error?t.message:"Failed to create guest match";x.oR.error(e),p("error"),v(e)}finally{w(!1)}})()},[t,A,k]),(0,s.useEffect)(()=>{let e=()=>{N&&console.log("Guest match creation cancelled on page unload")},t=()=>{"hidden"===document.visibilityState&&N&&console.log("Guest match creation cancelled on page hidden")};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[N]);let R=async()=>{try{p("cancelled"),A.push("/landing")}catch(e){console.error("Error cancelling queue:",e),p("error"),v("Failed to cancel queue. Please try again.")}},S={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.5,staggerChildren:.2}}},M={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4}}};return t?(0,a.jsxs)("div",{className:"min-h-screen bg-blue-50 p-4 sm:p-8 relative overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute inset-0 overflow-hidden opacity-10",children:[(0,a.jsx)("div",{className:"absolute left-0 top-0 h-[500px] w-[500px] bg-blue-400 rounded-full filter blur-3xl"}),(0,a.jsx)("div",{className:"absolute right-0 bottom-0 h-[500px] w-[500px] bg-cyan-400 rounded-full filter blur-3xl"})]}),(0,a.jsx)(h.P.div,{className:"relative z-10 max-w-5xl mx-auto flex items-center justify-center min-h-screen",variants:S,initial:"hidden",animate:"visible",children:(0,a.jsxs)(n.Zp,{className:"bg-white/90 border-blue-200 shadow-xl",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-2xl font-bold text-center text-black",children:"You've Already Played!"})}),(0,a.jsx)(n.Wu,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("p",{className:"text-lg text-black/70 mb-4",children:"You've already completed your guest match. To play more matches and save your progress, please create an account."}),(0,a.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,a.jsx)(o.$,{className:"px-6 py-3 text-white font-semibold rounded-full transition-colors duration-300",style:{backgroundColor:"#2599D4"},onClick:()=>A.push("/register"),children:"Sign Up Now"}),(0,a.jsx)(o.$,{variant:"outline",className:"px-6 py-3 text-black font-semibold rounded-full border-2 border-gray-300",onClick:()=>A.push("/landing"),children:"Back to Home"})]})]})})]})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-blue-50 p-4 sm:p-8 relative overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute inset-0 overflow-hidden opacity-10",children:[(0,a.jsx)("div",{className:"absolute left-0 top-0 h-[500px] w-[500px] bg-blue-400 rounded-full filter blur-3xl"}),(0,a.jsx)("div",{className:"absolute right-0 bottom-0 h-[500px] w-[500px] bg-cyan-400 rounded-full filter blur-3xl"})]}),(0,a.jsx)(h.P.div,{className:"relative z-10 max-w-5xl mx-auto flex items-center justify-center min-h-screen",variants:S,initial:"hidden",animate:"visible",children:(0,a.jsxs)("div",{className:"w-full space-y-8",children:[(0,a.jsx)(h.P.div,{variants:M,children:(0,a.jsxs)(n.Zp,{className:"bg-white/90 border-blue-200 shadow-xl",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-2xl font-bold text-center text-black",children:"Queue Statistics"})}),(0,a.jsxs)(n.Wu,{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(i.A,{className:"h-8 w-8 mx-auto mb-2",style:{color:"#2599D4"}}),(0,a.jsx)("p",{className:"text-2xl font-bold text-black",children:y.playersInQueue}),(0,a.jsx)("p",{className:"text-sm text-black/70",children:"Players in Queue"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(c.A,{className:"h-8 w-8 mx-auto mb-2 text-yellow-600"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-black",children:y.ongoingMatches}),(0,a.jsx)("p",{className:"text-sm text-black/70",children:"Ongoing Matches"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(d.A,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-black",children:[y.averageWaitTime,"s"]}),(0,a.jsx)("p",{className:"text-sm text-black/70",children:"Avg. Wait Time"})]})]})]})}),(0,a.jsx)(f.N,{mode:"wait",children:(0,a.jsx)(h.P.div,{variants:S,initial:"hidden",animate:"visible",exit:"hidden",children:(0,a.jsxs)(n.Zp,{className:"bg-white/90 border-blue-200 shadow-xl overflow-hidden",children:[(0,a.jsx)(n.aR,{className:"bg-white/50",children:(0,a.jsxs)(n.ZB,{className:"text-2xl font-bold text-center text-black",children:["Finding Match","matched"===r&&" - Match Found!","error"===r&&" - Error","cancelled"===r&&" - Cancelled"]})}),(0,a.jsx)(n.Wu,{className:"p-8",children:(0,a.jsxs)(h.P.div,{variants:M,children:["waiting"===r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.A,{className:"h-20 w-20 animate-spin text-blue-500"}),(0,a.jsx)(i.A,{className:"h-10 w-10 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-slate-200"})]})}),(0,a.jsx)("p",{className:"text-center mb-6 text-xl text-black/70",children:"Searching for an opponent..."}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)(o.$,{className:"px-6 py-3 text-white font-semibold rounded-full transition-colors duration-300 flex items-center text-lg",onClick:R,style:{backgroundColor:"#dc2626"},children:[(0,a.jsx)(m.A,{className:"mr-2 h-5 w-5"}),"Cancel"]})})]}),"error"===r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("p",{className:"text-xl text-red-600 mb-2",children:g||"An error occurred"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"The backend server might not be running. Please try again or contact support."})]}),(0,a.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,a.jsx)(o.$,{className:"px-6 py-3 text-white font-semibold rounded-full transition-colors duration-300 text-lg",onClick:()=>{C(!1),p("waiting"),v(null)},style:{backgroundColor:"#10b981"},children:"Try Again"}),(0,a.jsx)(o.$,{className:"px-6 py-3 text-white font-semibold rounded-full transition-colors duration-300 text-lg",onClick:()=>A.push("/landing"),style:{backgroundColor:"#2599D4"},children:"Back to Home"})]})]})]})})]})},r)})]})})]})}},86651:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},86948:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>i,Zp:()=>o,aR:()=>n,wL:()=>u});var a=r(95155),s=r(12115),l=r(64269);let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});o.displayName="Card";let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...s})});n.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});i.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},91169:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},93080:(e,t,r)=>{"use strict";r.d(t,{default:()=>N});var a=r(95155),s=r(20063),l=r(12115),o=r(65993),n=r(85921),i=r(54485),c=r(6613),d=r(15870),u=r(90368),m=r(9540),x=r(84926),h=r(17037),f=r(3998),p=r(52619),b=r.n(p),g=r(1733),v=r(26497);let y=[{to:"/",icon:o.A,label:"Home"},{to:"/play",icon:n.A,label:"Play"},{to:"/match-history",icon:i.A,label:"History"},{to:"/leaderboard",icon:c.A,label:"Leaderboard"},{to:"/settings",icon:d.A,label:"Settings"}];function j(e){let{session:t,logoutAction:r}=e;(0,s.useRouter)(),(0,s.usePathname)();let[o,n]=l.useState(!0),i=()=>{n(!o)};return(0,a.jsxs)(g.P.aside,{className:"bg-gradient-to-b from-blue-50 to-blue-100 text-black flex flex-col h-screen border-r border-blue-200",initial:{width:"20rem"},animate:{width:o?"20rem":"6rem"},transition:{duration:.3},children:[(0,a.jsxs)("div",{className:"p-6 flex items-center justify-center border-b border-blue-200 relative bg-white/50",children:[(0,a.jsx)(v.N,{children:o?(0,a.jsxs)(g.P.div,{className:"flex items-center gap-2 justify-center w-full",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},children:[(0,a.jsx)("img",{src:"/logo.png",alt:"LeetBattle Logo",width:32,height:32,className:"h-8 w-8"}),(0,a.jsx)("span",{className:"text-xl font-semibold font-mono",style:{color:"#2599D4"},children:"LeetBattle"})]}):(0,a.jsx)(g.P.div,{className:"w-full h-full flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)("img",{src:"/logo.png",alt:"LeetBattle Logo",width:32,height:32,className:"h-8 w-8"})})}),o&&(0,a.jsx)(f.$,{variant:"ghost",size:"icon",onClick:i,className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-black/60 hover:text-black hover:bg-blue-100/50",children:(0,a.jsx)(u.A,{className:"w-8 h-8"})}),!o&&(0,a.jsx)(f.$,{variant:"ghost",size:"icon",onClick:i,className:"absolute inset-0 w-full h-full flex items-center justify-center text-black/60 hover:text-black hover:bg-blue-100/50",children:(0,a.jsx)(m.A,{className:"w-8 h-8 stroke-2"})})]}),(0,a.jsx)(h.F,{className:"flex-1 bg-gradient-to-b from-white/30 to-blue-50/30",children:(0,a.jsx)("nav",{className:"py-6",children:y.map(e=>(0,a.jsxs)(b(),{href:e.to,className:"flex items-center px-4 py-4 mb-3 mx-2 rounded-lg transition-colors text-black/70 hover:text-black hover:bg-white/50",children:[(0,a.jsx)(e.icon,{className:"w-8 h-8 flex-shrink-0"}),(0,a.jsx)(v.N,{children:o&&(0,a.jsx)(g.P.span,{className:"ml-4 text-xl",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},children:e.label})})]},e.to))})}),(0,a.jsx)("div",{className:"p-4 border-t border-blue-200 bg-white/50",children:(0,a.jsx)("form",{action:r,children:(0,a.jsxs)(f.$,{type:"submit",variant:"ghost",className:"w-full justify-start text-red-600 hover:text-red-700 hover:bg-red-50 py-4",children:[(0,a.jsx)(x.A,{className:"w-8 h-8 flex-shrink-0"}),(0,a.jsx)(v.N,{children:o&&(0,a.jsx)(g.P.span,{className:"ml-4 text-xl",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},children:"Logout"})})]})})})]})}function N(e){let{session:t,showNavbar:r,logoutAction:o,children:n}=e,i=(0,s.useRouter)();return((0,l.useEffect)(()=>{t||i.push("/landing")},[t,i]),t)?(0,a.jsxs)("div",{className:"flex h-screen",children:[r&&(0,a.jsx)(j,{session:t,logoutAction:o}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto",children:n})]}):null}}},e=>{e.O(0,[4022,1733,5635,7597,4744,1597,8441,1255,7358],()=>e(e.s=57297)),_N_E=e.O()}]);